From 46a4048775636b8c072fe0fc91372659b5741b1e Mon Sep 17 00:00:00 2001
From: Rick C <rickfitsnugly@gmail.com>
Date: Tue, 18 Sep 2012 20:09:13 -0400
Subject: [PATCH 07/10] NavigationBar: Custom height (2/2)

Ported from http://review.cyanogenmod.org/#/c/23610/

Change-Id: I751ae54de1adf96367948735558363ce0dbb9f89
---
 res/values/arrays.xml                              |   21 +++++++++++++++
 res/values/strings.xml                             |   10 +++++++
 res/xml/system_settings.xml                        |    9 +++++++
 .../settings/cyanogenmod/SystemSettings.java       |   28 +++++++++++++++++++-
 4 files changed, 67 insertions(+), 1 deletion(-)

diff --git a/res/values/arrays.xml b/res/values/arrays.xml
index 47c5e6d..2c23f23 100644
--- a/res/values/arrays.xml
+++ b/res/values/arrays.xml
@@ -1284,5 +1284,26 @@
         <item>2</item>
     </string-array>
 
+    <!--- Nav buttons height -->
+    <string-array name="nav_buttons_height_entries" translatable="false">
+        <item>@string/navigation_bar_height_48</item>
+        <item>@string/navigation_bar_height_44</item>
+        <item>@string/navigation_bar_height_40</item>
+        <item>@string/navigation_bar_height_36</item>
+        <item>@string/navigation_bar_height_32</item>
+        <item>@string/navigation_bar_height_28</item>
+        <item>@string/navigation_bar_height_24</item>
+    </string-array>
+
+    <string-array name="nav_buttons_height_values" translatable="false">
+        <item>48</item>
+        <item>44</item>
+        <item>40</item>
+        <item>36</item>
+        <item>32</item>
+        <item>28</item>
+        <item>24</item>
+    </string-array>
+
     <!-- **** CYANOGENMOD ADDITIONS END **** -->
 </resources>
diff --git a/res/values/strings.xml b/res/values/strings.xml
index 3edeb43..a451a6e 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -4938,6 +4938,16 @@
     <string name="navigation_bar_menu_editable">Editable</string>
     <string name="navigation_bar_menu_locked">Locked</string>
 
+    <!-- Navigation Bar Height -->
+    <string name="navigation_bar_height">Button height</string>
+    <string name="navigation_bar_height_48">48dp (default)</string>
+    <string name="navigation_bar_height_44">44dp</string>
+    <string name="navigation_bar_height_40">40dp</string>
+    <string name="navigation_bar_height_36">36dp</string>
+    <string name="navigation_bar_height_32">32dp</string>
+    <string name="navigation_bar_height_28">28dp</string>
+    <string name="navigation_bar_height_24">24dp</string>
+
     <!-- Power Widget  -->
     <string name="power_widget_title">Power widget</string>
     <string name="title_expanded_widget">Power widget</string>
diff --git a/res/xml/system_settings.xml b/res/xml/system_settings.xml
index c92d360..17d42ce 100644
--- a/res/xml/system_settings.xml
+++ b/res/xml/system_settings.xml
@@ -82,6 +82,15 @@
             android:key="navigation_ring"
             android:fragment="com.android.settings.cyanogenmod.NavRing"
             android:title="@string/navigation_ring_title" />
+
+        <ListPreference
+            android:key="nav_buttons_height"
+            android:dialogTitle="@string/navigation_bar_height"
+            android:title="@string/navigation_bar_height"
+            android:entries="@array/nav_buttons_height_entries"
+            android:entryValues="@array/nav_buttons_height_values"
+            android:defaultValue="48"
+            android:persistent="false" />
     </PreferenceCategory>
 
     <CheckBoxPreference
diff --git a/src/com/android/settings/cyanogenmod/SystemSettings.java b/src/com/android/settings/cyanogenmod/SystemSettings.java
index 360ad3a..4ac51b5 100644
--- a/src/com/android/settings/cyanogenmod/SystemSettings.java
+++ b/src/com/android/settings/cyanogenmod/SystemSettings.java
@@ -30,6 +30,7 @@ import android.os.UserHandle;
 import android.os.IBinder;
 import android.os.IPowerManager;
 import android.preference.CheckBoxPreference;
+import android.preference.ListPreference;
 import android.preference.Preference;
 import android.preference.PreferenceScreen;
 import android.provider.Settings;
@@ -42,7 +43,7 @@ import com.android.settings.SettingsPreferenceFragment;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
-public class SystemSettings extends SettingsPreferenceFragment {
+public class SystemSettings extends SettingsPreferenceFragment implements Preference.OnPreferenceChangeListener {
     private static final String TAG = "SystemSettings";
 
     private static final String KEY_NOTIFICATION_PULSE = "notification_pulse";
@@ -51,6 +52,7 @@ public class SystemSettings extends SettingsPreferenceFragment {
     private static final String KEY_NAVIGATION_BAR = "navigation_bar";
     private static final String KEY_NAVIGATION_RING = "navigation_ring";
     private static final String KEY_NAVIGATION_BAR_CATEGORY = "navigation_bar_category";
+    private static final String KEY_NAVIGATION_HEIGHT = "nav_buttons_height";
     private static final String KEY_LOCK_CLOCK = "lock_clock";
     private static final String KEY_STATUS_BAR = "status_bar";
     private static final String KEY_QUICK_SETTINGS = "quick_settings_panel";
@@ -63,6 +65,7 @@ public class SystemSettings extends SettingsPreferenceFragment {
     private PreferenceScreen mBatteryPulse;
     private PreferenceScreen mPieControl;
     private boolean mIsPrimary;
+    private ListPreference mNavButtonsHeight;
     private CheckBoxPreference mKonstaNavbar;
 
     @Override
@@ -103,6 +106,15 @@ public class SystemSettings extends SettingsPreferenceFragment {
                 }
             }
 
+            // Navbar height
+            mNavButtonsHeight = (ListPreference) findPreference(KEY_NAVIGATION_HEIGHT);
+            mNavButtonsHeight.setOnPreferenceChangeListener(this);
+
+            int statusNavButtonsHeight = Settings.System.getInt(getActivity().getApplicationContext().getContentResolver(),
+                    Settings.System.NAV_BUTTONS_HEIGHT, 48);
+            mNavButtonsHeight.setValue(String.valueOf(statusNavButtonsHeight));
+            mNavButtonsHeight.setSummary(mNavButtonsHeight.getEntry());
+
             // Act on the above
             if (removeKeys) {
                 prefScreen.removePreference(findPreference(KEY_HARDWARE_KEYS));
@@ -110,6 +122,7 @@ public class SystemSettings extends SettingsPreferenceFragment {
             if (removeNavbar) {
                 prefScreen.removePreference(findPreference(KEY_NAVIGATION_BAR));
                 prefScreen.removePreference(findPreference(KEY_NAVIGATION_RING));
+                prefScreen.removePreference(findPreference(KEY_NAVIGATION_HEIGHT));
                 prefScreen.removePreference(findPreference(KEY_NAVIGATION_BAR_CATEGORY));
             }
         } else {
@@ -118,6 +131,7 @@ public class SystemSettings extends SettingsPreferenceFragment {
             prefScreen.removePreference(findPreference(KEY_HARDWARE_KEYS));
             prefScreen.removePreference(findPreference(KEY_NAVIGATION_BAR));
             prefScreen.removePreference(findPreference(KEY_NAVIGATION_RING));
+            prefScreen.removePreference(findPreference(KEY_NAVIGATION_HEIGHT));
             prefScreen.removePreference(findPreference(KEY_NAVIGATION_BAR_CATEGORY));
             prefScreen.removePreference(findPreference(KEY_STATUS_BAR));
             prefScreen.removePreference(findPreference(KEY_QUICK_SETTINGS));
@@ -251,4 +265,16 @@ public class SystemSettings extends SettingsPreferenceFragment {
         }
         return false;
     }
+
+    public boolean onPreferenceChange(Preference preference, Object objValue) {
+        if (preference == mNavButtonsHeight) {
+            int statusNavButtonsHeight = Integer.valueOf((String) objValue);
+            int index = mNavButtonsHeight.findIndexOfValue((String) objValue);
+            Settings.System.putInt(getActivity().getApplicationContext().getContentResolver(),
+                    Settings.System.NAV_BUTTONS_HEIGHT, statusNavButtonsHeight);
+            mNavButtonsHeight.setSummary(mNavButtonsHeight.getEntries()[index]);
+            return true;
+        }
+        return false;
+    }
 }
-- 
1.7.9.5

